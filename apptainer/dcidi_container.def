BootStrap: docker
From: ubuntu:22.04

%files
	./requirements_cp310.txt

%post
	TZ=Europe/Berlin
	ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
	
	apt -y update && apt -y upgrade 

	# Install python
	apt install -y python3-pip 
	pip3 install --upgrade pip

	echo "PYTHON VERSION"
	python3 --version # 3.10.12
	pip3 --version # 23.3.2

	# Install R and required packages
	apt install -y gnupg2
	apt install software-properties-common -y

	apt-get install r-base -y

	apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
	add-apt-repository 'deb https://cloud.r-project.org/bin/linux/ubuntu bionic-cran35/' -y
	apt-get -qq install libssl-dev -y
	apt-get -qq install libgmp3-dev  -y
	apt-get -qq install git -y
	apt-get -qq install build-essential  -y
	apt-get -qq install libv8-dev  -y
	apt-get -qq install libcurl4-openssl-dev -y
	apt-get -qq install libgsl-dev -y

	Rscript -e 'install.packages(c("V8"),repos="http://cran.us.r-project.org", quiet=TRUE, verbose=FALSE)'
	Rscript -e 'install.packages(c("sfsmisc"),repos="http://cran.us.r-project.org", quiet=TRUE, verbose=FALSE)'
	Rscript -e 'install.packages(c("clue"),repos="http://cran.us.r-project.org", quiet=TRUE, verbose=FALSE)'
	Rscript -e 'install.packages("https://cran.r-project.org/src/contrib/Archive/randomForest/randomForest_4.6-14.tar.gz", repos=NULL, type="source")'
	Rscript -e 'install.packages(c("lattice"),repos="http://cran.us.r-project.org", quiet=TRUE, verbose=FALSE)'
	Rscript -e 'install.packages(c("devtools"),repos="http://cran.us.r-project.org", quiet=FALSE, verbose=TRUE)'
	Rscript -e 'install.packages(c("MASS"),repos="http://cran.us.r-project.org", quiet=TRUE, verbose=FALSE)'
	Rscript -e 'install.packages("BiocManager")'
	Rscript -e 'BiocManager::install(c("igraph"))'
	Rscript -e 'install.packages("https://cran.r-project.org/src/contrib/Archive/fastICA/fastICA_1.2-2.tar.gz", repos=NULL, type="source")'
	Rscript -e 'BiocManager::install(c("SID", "bnlearn", "pcalg", "kpcalg", "glmnet", "mboost"))'
	Rscript -e 'install.packages("https://cran.r-project.org/src/contrib/Archive/CAM/CAM_1.0.tar.gz", repos=NULL, type="source")'
	Rscript -e 'install.packages("https://cran.r-project.org/src/contrib/sparsebnUtils_0.0.8.tar.gz", repos=NULL, type="source")'
	Rscript -e 'BiocManager::install(c("ccdrAlgorithm", "discretecdAlgorithm"))'

	# Install python requirements
	pip3 install -r requirements_cp310.txt

    # Clean cache to reduce size of the image
    apt clean
    rm -r $(pip cache dir)/*

%startscript
	PATH=$PATH:$HOME/.local/bin

%labels
   Author Ja

